{{template "admin" .}} {{define "page-title"}} Reservations Calendar {{end}}
{{define "content"}}
<div class="row">
    {{$now := index .Data "now"}} {{$rooms := index .Data "rooms"}}
    {{$days_in_month := index .IntMap "days_in_month"}} {{$currMonth := index
    .StringMap "currMonth"}} {{$currYear := index .StringMap "currMonthYear"}}
    <div class="col-1">
        <a
            href="/admin/reservations-calendar?y={{index .StringMap `previous_month_year`}}&m={{index .StringMap `previous_month`}}"
            class="btn btn-md btn-outline-secondary"
            >&lt;&lt;</a
        >
    </div>
    <div class="text-center col-10">
        <h3>{{formatDate $now "January"}} {{formatDate $now "2006"}}</h3>
    </div>
    <div class="col-1">
        <a
            href="/admin/reservations-calendar?y={{index .StringMap `next_month_year`}}&m={{index .StringMap `next_month`}}"
            class="btn btn-md btn-outline-secondary"
            >&gt;&gt;</a
        >
    </div>

    <form action="/admin/reservations-calendar" method="post">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
        <input type="hidden" name="mon" value="{{index .StringMap "currMonth"}}">
        <input type="hidden" name="year" value="{{index .StringMap "currMonthYear"}}">
    {{range $rooms}} {{$roomId := .ID}} {{$blocks := index $.Data (printf
    "block_map_%d" .ID)}} {{$reservations := index $.Data (printf
    "reservation_map_%d" .ID)}}
    <h4 class="m-3">{{.RoomName}}</h4>
    <div class="table-responsive">
        <table class="table table-bordered table-sm">
            <tr class="table-dark">
                {{range iterate $days_in_month}}
                <td class="text-center">{{.}}</td>
                {{end}}
            </tr>
            <tr class="">
                {{range iterate $days_in_month}}
                <td class="text-center">
                    {{if gt (index $reservations (printf "%s-%s-%d" $currYear $currMonth .)) 0}}
                        <a href="/admin/reservations/cal/{{index $reservations (printf "%s-%s-%d" $currYear $currMonth .)}}/show?y={{$currYear}}&m={{$currMonth}}">
                            <span class="text-danger" style="font-weight: bold;">R</span>
                        </a>
                    {{else}}
                    <input {{if gt (index $blocks (printf "%s-%s-%d" $currYear $currMonth .)) 0}}
                        checked name="remove_block_{{$roomId}}_{{printf "%s-%s-%d" $currYear $currMonth .}}"
                        value="{{index $blocks (printf "%s-%s-%d" $currYear $currMonth .)}}"
                        {{else}}
                        name="add_block_{{$roomId}}_{{printf "%s-%s-%d" $currYear $currMonth .}}"
                        value="1"
                        {{end}}
                        type="checkbox" />
                    {{end}}
                </td>
                {{end}}
            </tr>
        </table>
    </div>
    {{end}}
    <hr>
    <input type="submit" class="btn btn-primary" value="Save Changes">
    </form>
</div>
{{end}}
